name: Release haproxy healthcheck binaries

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# on:
#   push:
#     tags:
#       - v*

jobs:
  build:
    runs-on: [ubuntu-20.04]

    steps:
      - name: checkout repo
        uses: actions/checkout@v3

      - name: setup go env
        uses: actions/setup-go@v3
        with:
          go-version: '1.19.7'
          check-latest: true

      - name: build binaries
        run: |
            # snappy
            apt-get install libsnappy-dev
            # protoc
            go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
            export PATH="$PATH:$(go env GOPATH)/bin"
            wget https://github.com/protocolbuffers/protobuf/releases/download/v22.3/protoc-22.3-linux-x86_64.zip
            unzip protoc-22.3-linux-x86_64.zip
            mv bin/protoc /usr/bin/protoc
            chmod +x /usr/bin/protoc
            # deps
            make gen-proto
            # build
            make full

      # - name: Create release
      #   uses: softprops/action-gh-release@v1
      #   with:
      #     files: |
      #       radiance
